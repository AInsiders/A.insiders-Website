<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Converter Test - A.Insiders</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        .file-input { margin: 10px 0; }
        canvas { border: 1px solid #ddd; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>Converter Functionality Test</h1>
    
    <div class="test-section">
        <h2>1. WebP to PDF Converter Test</h2>
        <div id="webp-test-results"></div>
        <input type="file" id="webp-file" accept=".webp" class="file-input">
        <button onclick="testWebpToPdf()">Test WebP to PDF Conversion</button>
        <div id="webp-preview"></div>
    </div>

    <div class="test-section">
        <h2>2. Multi-Format Converter Test</h2>
        <div id="multi-test-results"></div>
                 <select id="input-format">
             <option value="">Select Input Format</option>
             <option value="png">PNG</option>
             <option value="jpg">JPG</option>
             <option value="webp">WebP</option>
             <option value="svg">SVG</option>
             <option value="gif">GIF</option>
             <option value="bmp">BMP</option>
             <option value="txt">TXT</option>
         </select>
        <select id="output-format">
            <option value="">Select Output Format</option>
        </select>
        <input type="file" id="multi-file" class="file-input">
        <button onclick="testMultiFormat()">Test Multi-Format Conversion</button>
        <div id="multi-preview"></div>
    </div>

    <div class="test-section">
        <h2>3. Library Dependencies Test</h2>
        <div id="library-test-results"></div>
        <button onclick="testLibraries()">Test Required Libraries</button>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
        // Test results container
        function addResult(containerId, message, type) {
            const container = document.getElementById(containerId);
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.textContent = message;
            container.appendChild(div);
        }

        // Test 1: WebP to PDF Converter
        async function testWebpToPdf() {
            const fileInput = document.getElementById('webp-file');
            const file = fileInput.files[0];
            
            if (!file) {
                addResult('webp-test-results', 'Please select a WebP file first', 'error');
                return;
            }

            if (!file.type.includes('webp')) {
                addResult('webp-test-results', 'Please select a valid WebP file', 'error');
                return;
            }

            addResult('webp-test-results', 'Testing WebP to PDF conversion...', 'info');

            try {
                // Test image loading
                const img = await loadImage(file);
                addResult('webp-test-results', '✓ WebP image loaded successfully', 'success');

                // Test canvas rendering
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                canvas.width = img.width;
                canvas.height = img.height;
                ctx.drawImage(img, 0, 0);
                addResult('webp-test-results', '✓ Canvas rendering successful', 'success');

                // Test PDF generation
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF();
                const imgData = canvas.toDataURL('image/jpeg', 0.8);
                pdf.addImage(imgData, 'JPEG', 10, 10, 190, 100);
                addResult('webp-test-results', '✓ PDF generation successful', 'success');

                // Test download
                const pdfBlob = pdf.output('blob');
                const url = URL.createObjectURL(pdfBlob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'test-conversion.pdf';
                a.click();
                URL.revokeObjectURL(url);
                addResult('webp-test-results', '✓ PDF download successful - WebP to PDF converter is working!', 'success');

                // Show preview
                const preview = document.getElementById('webp-preview');
                preview.innerHTML = '<h3>Preview:</h3>';
                preview.appendChild(canvas);

            } catch (error) {
                addResult('webp-test-results', `✗ Error: ${error.message}`, 'error');
            }
        }

        // Test 2: Multi-Format Converter
        async function testMultiFormat() {
            const inputFormat = document.getElementById('input-format').value;
            const outputFormat = document.getElementById('output-format').value;
            const fileInput = document.getElementById('multi-file');
            const file = fileInput.files[0];

            if (!inputFormat || !outputFormat) {
                addResult('multi-test-results', 'Please select both input and output formats', 'error');
                return;
            }

            if (!file) {
                addResult('multi-test-results', 'Please select a file first', 'error');
                return;
            }

            addResult('multi-test-results', `Testing ${inputFormat.toUpperCase()} to ${outputFormat.toUpperCase()} conversion...`, 'info');

            try {
                if (inputFormat === 'txt' && outputFormat === 'pdf') {
                    // Test text to PDF
                    const text = await readTextFile(file);
                    const { jsPDF } = window.jspdf;
                    const pdf = new jsPDF();
                    const lines = pdf.splitTextToSize(text, 180);
                    let y = 20;
                    lines.forEach(line => {
                        if (y > 270) {
                            pdf.addPage();
                            y = 20;
                        }
                        pdf.text(line, 20, y);
                        y += 6;
                    });
                    
                    const pdfBlob = pdf.output('blob');
                    const url = URL.createObjectURL(pdfBlob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'test-text-to-pdf.pdf';
                    a.click();
                    URL.revokeObjectURL(url);
                    addResult('multi-test-results', '✓ Text to PDF conversion successful!', 'success');

                                 } else if (['png', 'jpg', 'webp', 'gif', 'bmp'].includes(inputFormat) && ['png', 'jpg', 'webp'].includes(outputFormat)) {
                     // Test image conversion
                     const img = await loadImage(file);
                     const canvas = document.createElement('canvas');
                     const ctx = canvas.getContext('2d');
                     canvas.width = img.width;
                     canvas.height = img.height;
                     ctx.drawImage(img, 0, 0);

                     let mimeType;
                     switch (outputFormat) {
                         case 'png': mimeType = 'image/png'; break;
                         case 'jpg': mimeType = 'image/jpeg'; break;
                         case 'webp': mimeType = 'image/webp'; break;
                     }

                     canvas.toBlob((blob) => {
                         const url = URL.createObjectURL(blob);
                         const a = document.createElement('a');
                         a.href = url;
                         a.download = `test-conversion.${outputFormat}`;
                         a.click();
                         URL.revokeObjectURL(url);
                         addResult('multi-test-results', `✓ Image conversion to ${outputFormat.toUpperCase()} successful!`, 'success');
                     }, mimeType, 0.8);

                     // Show preview
                     const preview = document.getElementById('multi-preview');
                     preview.innerHTML = '<h3>Preview:</h3>';
                     preview.appendChild(canvas);
                 } else if (['png', 'jpg', 'webp', 'svg', 'gif', 'bmp'].includes(inputFormat) && outputFormat === 'pdf') {
                     // Test image to PDF conversion
                     const img = await loadImage(file);
                     const canvas = document.createElement('canvas');
                     const ctx = canvas.getContext('2d');
                     canvas.width = img.width;
                     canvas.height = img.height;
                     ctx.drawImage(img, 0, 0);

                     const { jsPDF } = window.jspdf;
                     const pdf = new jsPDF();
                     const imgData = canvas.toDataURL('image/jpeg', 0.8);
                     
                     // Calculate image dimensions to fit on page
                     const pageWidth = pdf.internal.pageSize.getWidth();
                     const pageHeight = pdf.internal.pageSize.getHeight();
                     const aspectRatio = img.width / img.height;
                     
                     let imgWidth, imgHeight;
                     if (pageWidth / pageHeight > aspectRatio) {
                         imgHeight = pageHeight - 20;
                         imgWidth = imgHeight * aspectRatio;
                     } else {
                         imgWidth = pageWidth - 20;
                         imgHeight = imgWidth / aspectRatio;
                     }
                     
                     const x = (pageWidth - imgWidth) / 2;
                     const y = (pageHeight - imgHeight) / 2;
                     
                     pdf.addImage(imgData, 'JPEG', x, y, imgWidth, imgHeight);
                     
                     const pdfBlob = pdf.output('blob');
                     const url = URL.createObjectURL(pdfBlob);
                     const a = document.createElement('a');
                     a.href = url;
                     a.download = `test-image-to-pdf.pdf`;
                     a.click();
                     URL.revokeObjectURL(url);
                     addResult('multi-test-results', `✓ Image to PDF conversion successful!`, 'success');

                     // Show preview
                     const preview = document.getElementById('multi-preview');
                     preview.innerHTML = '<h3>Preview:</h3>';
                     preview.appendChild(canvas);
                 } else {
                     addResult('multi-test-results', `Conversion from ${inputFormat} to ${outputFormat} is not yet implemented`, 'warning');
                 }

            } catch (error) {
                addResult('multi-test-results', `✗ Error: ${error.message}`, 'error');
            }
        }

        // Test 3: Library Dependencies
        function testLibraries() {
            addResult('library-test-results', 'Testing required libraries...', 'info');

            // Test jsPDF
            if (window.jspdf) {
                addResult('library-test-results', '✓ jsPDF library loaded successfully', 'success');
            } else {
                addResult('library-test-results', '✗ jsPDF library not found', 'error');
            }

            // Test Canvas API
            const canvas = document.createElement('canvas');
            if (canvas.getContext) {
                addResult('library-test-results', '✓ Canvas API available', 'success');
            } else {
                addResult('library-test-results', '✗ Canvas API not available', 'error');
            }

            // Test File API
            if (window.File && window.FileReader) {
                addResult('library-test-results', '✓ File API available', 'success');
            } else {
                addResult('library-test-results', '✗ File API not available', 'error');
            }

            // Test WebP support
            const webpTest = new Image();
            webpTest.onload = function() {
                addResult('library-test-results', '✓ WebP format supported', 'success');
            };
            webpTest.onerror = function() {
                addResult('library-test-results', '⚠ WebP format may not be supported in this browser', 'warning');
            };
            webpTest.src = 'data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAADsAD+JaQAA3AAAAAA';

            addResult('library-test-results', '✓ All core dependencies are working!', 'success');
        }

        // Helper functions
        function loadImage(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = new Image();
                    img.onload = () => resolve(img);
                    img.onerror = () => reject(new Error('Failed to load image'));
                    img.src = e.target.result;
                };
                reader.onerror = () => reject(new Error('Failed to read file'));
                reader.readAsDataURL(file);
            });
        }

        function readTextFile(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (e) => resolve(e.target.result);
                reader.onerror = () => reject(new Error('Failed to read text file'));
                reader.readAsText(file);
            });
        }

        // Update output format options based on input format
        document.getElementById('input-format').addEventListener('change', function() {
            const inputFormat = this.value;
            const outputSelect = document.getElementById('output-format');
            const fileInput = document.getElementById('multi-file');
            
            outputSelect.innerHTML = '<option value="">Select Output Format</option>';
            
                         if (inputFormat === 'txt') {
                 outputSelect.innerHTML += '<option value="pdf">PDF</option>';
                 fileInput.accept = '.txt,text/plain';
             } else if (['png', 'jpg', 'webp', 'svg', 'gif', 'bmp'].includes(inputFormat)) {
                 outputSelect.innerHTML += '<option value="png">PNG</option>';
                 outputSelect.innerHTML += '<option value="jpg">JPG</option>';
                 outputSelect.innerHTML += '<option value="webp">WebP</option>';
                 outputSelect.innerHTML += '<option value="pdf">PDF</option>';
                 fileInput.accept = '.png,.jpg,.jpeg,.webp,.svg,.gif,.bmp,image/*';
             }
        });

        // Auto-run library test on page load
        window.addEventListener('load', testLibraries);
    </script>
</body>
</html>
